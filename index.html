<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­‹ãƒˆãƒ¬è¨˜éŒ² & ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ææ¡ˆã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #999;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .three-cols {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .record-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
        }

        .record-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .add-set-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
        }

        .add-set-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
        }

        .suggestion-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
        }

        .suggestion-section h2 {
            color: #d35400;
            margin-bottom: 20px;
        }

        .suggestion-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .suggestion-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .suggestion-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .charts-section {
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .history-section {
            margin-top: 30px;
        }

        .history-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .history-group {
            margin-bottom: 25px;
        }

        .history-group h3 {
            color: #764ba2;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item-content {
            flex: 1;
        }

        .history-item-actions {
            display: flex;
            gap: 5px;
        }

        .history-item strong {
            color: #667eea;
        }

        .edit-btn, .delete-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .edit-btn {
            background: #4caf50;
            color: white;
        }

        .edit-btn:hover {
            transform: scale(1.05);
            background: #45a049;
        }

        .delete-btn {
            background: #f44336;
            color: white;
        }

        .delete-btn:hover {
            transform: scale(1.05);
            background: #da190b;
        }

        .export-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin-right: 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
        }

        .clear-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .exercise-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            color: #1565c0;
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-size: 12px;
            margin-right: 5px;
        }

        .asuka-comment {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #e17055;
            font-size: 16px;
            font-weight: bold;
            color: #2d3436;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .asuka-comment::before {
            content: "ğŸ‘§ æ˜æ—¥é¦™: ";
            color: #e17055;
        }

        .previous-set-info {
            background: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
            display: none;
        }

        .current-sets {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .current-sets h4 {
            color: #e65100;
            margin-bottom: 10px;
        }

        .set-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            border-left: 3px solid #ff9800;
        }

        /* ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn.save {
            background: #4caf50;
            color: white;
        }

        .modal-btn.save:hover {
            transform: scale(1.05);
            background: #45a049;
        }

        .modal-btn.cancel {
            background: #999;
            color: white;
        }

        .modal-btn.cancel:hover {
            transform: scale(1.05);
            background: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’ª ç­‹ãƒˆãƒ¬è¨˜éŒ²ã‚¢ãƒ—ãƒª</h1>
        <p class="subtitle">ç§‘å­¦çš„ãªã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ææ¡ˆã§åŠ¹ç‡çš„ã«æˆé•·</p>

        <div id="message" class="message"></div>
        <div id="asukaComment" class="asuka-comment"></div>

        <!-- ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('record')">ğŸ“ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®è¨˜éŒ²</button>
            <button class="tab" onclick="switchTab('stats')">ğŸ“Š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®çµ±è¨ˆ</button>
            <button class="tab" onclick="switchTab('history')">ğŸ“š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å±¥æ­´</button>
        </div>

        <!-- è¨˜éŒ²ã‚¿ãƒ– -->
        <div id="recordTab" class="tab-content active">
            <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ææ¡ˆ -->
            <div id="suggestionSection" class="suggestion-section"></div>

            <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="input-section">
                <h2 style="color: #667eea; margin-bottom: 20px;">ğŸ“ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</h2>
                
                <div class="input-group">
                    <label>ç¨®ç›®ã‚’é¸æŠ</label>
                    <select id="exercise" onchange="showExerciseInfo()">
                        <option value="">-- ç¨®ç›®ã‚’é¸æŠ --</option>
                        <optgroup label="èƒ¸">
                            <option value="ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                            <option value="ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹">ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                            <option value="ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤">ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤</option>
                        </optgroup>
                        <optgroup label="èƒŒä¸­">
                            <option value="ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</option>
                            <option value="ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³">ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³</option>
                            <option value="ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ã‚¦">ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ã‚¦</option>
                            <option value="æ‡¸å‚">æ‡¸å‚</option>
                        </optgroup>
                        <optgroup label="è„š">
                            <option value="ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                            <option value="ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹">ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹</option>
                            <option value="ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«">ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«</option>
                            <option value="ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³">ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³</option>
                        </optgroup>
                        <optgroup label="è‚©">
                            <option value="ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹">ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹</option>
                            <option value="ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º">ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º</option>
                            <option value="ãƒªã‚¢ãƒ‡ãƒ«ãƒˆ">ãƒªã‚¢ãƒ‡ãƒ«ãƒˆ</option>
                        </optgroup>
                        <optgroup label="è…•">
                            <option value="ãƒãƒ¼ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«">ãƒãƒ¼ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«</option>
                            <option value="ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³">ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³</option>
                            <option value="ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«">ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«</option>
                        </optgroup>
                        <optgroup label="è…¹ç­‹">
                            <option value="ã‚¯ãƒ©ãƒ³ãƒ">ã‚¯ãƒ©ãƒ³ãƒ</option>
                            <option value="ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º">ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º</option>
                            <option value="ãƒ—ãƒ©ãƒ³ã‚¯">ãƒ—ãƒ©ãƒ³ã‚¯ï¼ˆç§’ï¼‰</option>
                            <option value="ã‚¢ãƒ–ãƒ­ãƒ¼ãƒ©ãƒ¼">ã‚¢ãƒ–ãƒ­ãƒ¼ãƒ©ãƒ¼</option>
                            <option value="ãƒãƒ³ã‚®ãƒ³ã‚°ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º">ãƒãƒ³ã‚®ãƒ³ã‚°ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º</option>
                        </optgroup>
                    </select>
                    <div id="exerciseInfo" class="exercise-info"></div>
                    <div id="previousSetInfo" class="previous-set-info"></div>
                </div>

                <!-- ä»Šæ—¥ã®ã‚»ãƒƒãƒˆè¡¨ç¤º -->
                <div id="currentSets" class="current-sets">
                    <h4>ä»Šæ—¥ã®ã‚»ãƒƒãƒˆ</h4>
                    <div id="currentSetsList"></div>
                </div>

                <div class="three-cols">
                    <div class="input-group">
                        <label>é‡é‡ (kg)</label>
                        <input type="number" id="weight" placeholder="50" step="0.5" min="0">
                    </div>
                    <div class="input-group">
                        <label>å›æ•°</label>
                        <input type="number" id="reps" placeholder="10" min="1">
                    </div>
                    <div class="input-group">
                        <label>ã‚»ãƒƒãƒˆæ•°</label>
                        <input type="number" id="sets" placeholder="1" min="1" value="1">
                    </div>
                </div>

                <button class="record-btn" onclick="recordWorkout()">ã‚»ãƒƒãƒˆã‚’è¨˜éŒ²</button>
                <button class="add-set-btn" onclick="addAnotherSet()">åŒã˜ç¨®ç›®ã§ã‚»ãƒƒãƒˆè¿½åŠ </button>
            </div>
        </div>

        <!-- çµ±è¨ˆã‚¿ãƒ– -->
        <div id="statsTab" class="tab-content">
            <div class="charts-section">
                <div class="chart-container">
                    <h3>ğŸ“Š ç·è² è·é‡ã®æ¨ç§»</h3>
                    <canvas id="volumeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ğŸ‹ï¸ ç¨®ç›®åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
                    <canvas id="exerciseChart"></canvas>
                </div>
            </div>
        </div>

        <!-- å±¥æ­´ã‚¿ãƒ– -->
        <div id="historyTab" class="tab-content">
            <div class="button-group">
                <button class="export-btn" onclick="exportToMarkdown()">ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button class="clear-btn" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>

            <div class="history-section">
                <h2>ğŸ“š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´</h2>
                <div id="historyContent"></div>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ã‚»ãƒƒãƒˆã‚’ç·¨é›†</h2>
            </div>
            <div class="input-group">
                <label>ç¨®ç›®</label>
                <input type="text" id="editExercise" readonly>
            </div>
            <div class="three-cols">
                <div class="input-group">
                    <label>é‡é‡ (kg)</label>
                    <input type="number" id="editWeight" step="0.5" min="0">
                </div>
                <div class="input-group">
                    <label>å›æ•°</label>
                    <input type="number" id="editReps" min="1">
                </div>
                <div class="input-group">
                    <label>ã‚»ãƒƒãƒˆæ•°</label>
                    <input type="number" id="editSets" min="1">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn save" onclick="saveEdit()">ä¿å­˜</button>
                <button class="modal-btn cancel" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <script>
        const asukaComments = {
            success: [
                "ã‚„ã‚‹ã˜ã‚ƒãªã„ï¼å‰å›ã‚ˆã‚Šé‡é‡ä¸ŠãŒã£ã¦ã‚‹ã‚ã‚ˆï¼ã‚¢ã‚¿ã‚·ãŒæŒ‡å°ã—ãŸç”²æ–ãŒã‚ã£ãŸã‚ã­ï¼",
                "å½“ç„¶ã®çµæœã­ï¼ã‚¢ã‚¿ã‚·ã®è¨€ã†é€šã‚Šã«ã‚„ã‚Œã°ã“ã†ãªã‚‹ã®ã‚ˆï¼æ¬¡ã‚‚æœŸå¾…ã—ã¦ã‚‹ã‚ï¼",
                "ãµã‚“ã€ã¾ã‚ã¾ã‚ã˜ã‚ƒãªã„ã€‚ã‚¢ã‚¿ã‚·ãªã‚‰ã‚‚ã£ã¨ä½™è£•ã ã‘ã©...ã§ã‚‚ã€æ‚ªããªã„ã‚ï¼",
                "è¦‹ãªã•ã„ã‚ˆï¼ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰æˆåŠŸï¼ã‚¢ãƒ³ã‚¿ã‚‚ã‚„ã‚Œã°ã§ãã‚‹ã˜ã‚ƒãªã„ï¼",
                "å®Œç’§ï¼ã•ã™ãŒã‚¢ã‚¿ã‚·ãŒæ•™ãˆã¦ã‚‹ç”Ÿå¾’ã­ï¼ã“ã®èª¿å­ã§çªãé€²ã¿ãªã•ã„ï¼",
                "ã¡ã‚‡ã£ã¨ã€ã‚¢ãƒ³ã‚¿æ‰èƒ½ã‚ã‚‹ã‹ã‚‚ã­ï¼...ã¹ã€åˆ¥ã«è¤’ã‚ã¦ã‚‹ã‚ã‘ã˜ã‚ƒãªã„ã‚“ã ã‹ã‚‰ï¼",
                "ã„ã„ã‚ã‚ˆãã®èª¿å­ï¼ã‚¢ã‚¿ã‚·ã«è¿½ã„ã¤ã‘ã‚‹ã‚ˆã†ã«é ‘å¼µã‚Šãªã•ã„ï¼ã¾ã ã¾ã ã ã‘ã©ã­ï¼",
                "ã¸ã‡ã€ã‚„ã‚‹ã˜ã‚ƒãªã„ï¼ã§ã‚‚ã‚¢ã‚¿ã‚·ã¨æ¯”ã¹ãŸã‚‰ã¾ã ã¾ã ã‚ˆï¼ã‚‚ã£ã¨ä¸Šã‚’ç›®æŒ‡ã—ãªã•ã„ï¼",
                "ç´ æ™´ã‚‰ã—ã„ã‚ï¼ã“ã®èª¿å­ãªã‚‰ã‚¢ãƒ³ã‚¿ã‚‚ä¸€æµã«ãªã‚Œã‚‹ã‹ã‚‚ã­ï¼...ã‚¢ã‚¿ã‚·ã»ã©ã˜ã‚ƒãªã„ã‘ã©ã€‚",
                "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ã‚¢ã‚¿ã‚·ãŒè¦‹è¾¼ã‚“ã ã ã‘ã‚ã‚‹ã‚ï¼æ¬¡ã¯ã‚‚ã£ã¨é«˜ã¿ã‚’ç›®æŒ‡ã™ã‚ã‚ˆï¼"
            ],
            failure: [
                "ã¡ã‚‡ã£ã¨ï¼ä½•ã‚„ã£ã¦ã‚“ã®ã‚ˆï¼...ã¾ã‚ã€ç–²ã‚Œã¦ã‚‹æ—¥ã‚‚ã‚ã‚‹ã‚ã‚ˆã­ã€‚ä»Šæ—¥ã¯ä¼‘ã¿ãªã•ã„ã€‚",
                "ã¯ãï¼Ÿå‰å›ã¨åŒã˜ï¼Ÿ...ã¹ã€åˆ¥ã«æ°—ã«ã™ã‚‹ã“ã¨ãªã„ã‚ã‚ˆï¼æ¬¡é ‘å¼µã‚Œã°ã„ã„ã‚“ã ã‹ã‚‰ï¼",
                "ã‚¢ãƒ³ã‚¿ã€ç„¡ç†ã—ã¦ãªã„ï¼Ÿ...ãƒã‚«ã­ã€æ€ªæˆ‘ã—ãŸã‚‰å…ƒã‚‚å­ã‚‚ãªã„ã§ã—ã‚‡ï¼",
                "ãµã‚“ã€èª¿å­æ‚ªã„ã®ï¼Ÿã—ã‚‡ã†ãŒãªã„ã‚ã­...æ „é¤Šã¨ç¡çœ ã¯ã¡ã‚ƒã‚“ã¨å–ã‚Šãªã•ã„ã‚ˆï¼",
                "ãƒ€ãƒ¡ãƒ€ãƒ¡ã­ï¼...ã£ã¦è¨€ã„ãŸã„ã¨ã“ã‚ã ã‘ã©ã€ã‚ªãƒ¼ãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šãƒã‚·ã‚ˆã€‚",
                "ã‚ãƒ¼ã‚ã€é‡é‡ä¸ŠãŒã‚“ãªã‹ã£ãŸã‚ã­ã€‚ã§ã‚‚ç„¡ç†ã—ã¦æ€ªæˆ‘ã™ã‚‹ã‚ˆã‚Šã„ã„ã‚ã€‚æ¬¡ï¼",
                "ä½•ã‚ˆãã®è¨˜éŒ²ï¼...ã¾ã€ã¾ã‚ä½“èª¿æ‚ªã„æ—¥ã‚‚ã‚ã‚‹ã‚ã‚ˆã­ã€‚æ¬¡ã¯æœ¬æ°—å‡ºã—ãªã•ã„ã‚ˆï¼",
                "ã¡ã‚‡ã£ã¨ãƒ¼ï¼ã‚‚ã£ã¨æ°—åˆã„å…¥ã‚Œãªã•ã„ã‚ˆï¼...ã£ã¦ã€ä½“èª¿æ‚ªãã†ã­ã€‚ä»Šæ—¥ã¯è¨±ã—ã¦ã‚ã’ã‚‹ã€‚",
                "ã¯ã...ã‚¢ãƒ³ã‚¿ã‚‰ã—ããªã„ã‚ã­ã€‚ç–²ã‚Œã¦ã‚‹ãªã‚‰ç´ ç›´ã«ä¼‘ã¿ãªã•ã„ï¼ã‚¢ã‚¿ã‚·ãŒè¨€ã†ã‚“ã ã‹ã‚‰ï¼",
                "å‰å›è¶…ãˆã‚‰ã‚Œãªã‹ã£ãŸï¼Ÿåˆ¥ã«ã„ã„ã‚ã‚ˆï¼ç¶™ç¶šãŒå¤§äº‹ãªã‚“ã ã‹ã‚‰ï¼...ã‚ã‹ã£ã¦ã‚‹ã§ã—ã‚‡ã†ã­ï¼"
            ],
            normal: [
                "ã‚ˆã—ã€è¨˜éŒ²ã—ãŸã‚ã‚ˆï¼æ¬¡ã‚‚é ‘å¼µã‚Šãªã•ã„ï¼",
                "ã„ã„ã‚ã­ã€ãã®èª¿å­ã§ç¶šã‘ãªã•ã„ï¼",
                "ãµã‚“ã€æ‚ªããªã„ã‚ã€‚æ¬¡ã‚‚æœŸå¾…ã—ã¦ã‚‹ã‚ã‚ˆï¼"
            ]
        };

        const exerciseStrategies = {
            'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': { type: 'compound', repRange: '5-8', description: 'BIG3ã®ä¸€ã¤ã€‚é‡é‡é‡è¦–ã§2.5kgåˆ»ã¿ã§å¢—åŠ ã€‚', strategy: 'é‡é‡ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 1.25, 5], tips: 'ãƒ•ã‚©ãƒ¼ãƒ ç¶­æŒãŒæœ€å„ªå…ˆã€‚è‚©ã‚’ä¸‹ã’ã¦èƒ¸ã‚’å¼µã‚‹ã€‚', bodyPart: 'èƒ¸' },
            'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': { type: 'compound', repRange: '6-10', description: 'ä¸Šéƒ¨èƒ¸ç­‹ç‹™ã„ã€‚é€šå¸¸ã®ãƒ™ãƒ³ãƒã‚ˆã‚Šè»½ã‚ã®é‡é‡ã€‚', strategy: 'å›æ•°ã¨é‡é‡ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆã', weightIncrements: [2.5, 1.25], tips: 'è§’åº¦ã¯30-45åº¦ãŒæœ€é©ã€‚', bodyPart: 'èƒ¸' },
            'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤': { type: 'isolation', repRange: '10-15', description: 'èƒ¸ç­‹ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒç¨®ç›®ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é‡è¦–ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 1.25], tips: 'ã‚†ã£ãã‚Šé™ã‚ã—ã¦èƒ¸ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’æ„Ÿã˜ã‚‹ã€‚', bodyPart: 'èƒ¸' },
            'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ': { type: 'compound', repRange: '3-6', description: 'BIG3ã®ç‹æ§˜ã€‚å…¨èº«ã‚’ä½¿ã†é«˜é‡é‡ç¨®ç›®ã€‚', strategy: 'é‡é‡ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [5, 2.5, 10], tips: 'èƒŒä¸­ã‚’ä¸¸ã‚ãªã„ã€‚è…°ã‚’å®ˆã‚‹ãŸã‚ãƒ™ãƒ«ãƒˆæ¨å¥¨ã€‚', bodyPart: 'èƒŒä¸­' },
            'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³': { type: 'compound', repRange: '8-12', description: 'èƒŒä¸­ã®åºƒãŒã‚Šã‚’ä½œã‚‹ã€‚æ‡¸å‚ã®ä»£æ›¿ç¨®ç›®ã€‚', strategy: 'å›æ•°ã¨é‡é‡ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆã', weightIncrements: [2.5, 5], tips: 'è‚©ç”²éª¨ã‚’å¯„ã›ã¦èƒ¸ã«å¼•ãæ„è­˜ã€‚', bodyPart: 'èƒŒä¸­' },
            'ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ã‚¦': { type: 'compound', repRange: '6-10', description: 'èƒŒä¸­ã®åšã¿ã‚’ä½œã‚‹ã€‚è…°ã¸ã®è² æ‹…ã«æ³¨æ„ã€‚', strategy: 'é‡é‡ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'è†ã‚’è»½ãæ›²ã’ã¦èƒŒä¸­ã¯ã¾ã£ã™ãã€‚', bodyPart: 'èƒŒä¸­' },
            'æ‡¸å‚': { type: 'compound', repRange: '5-12', description: 'è‡ªé‡ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ç‹é“ã€‚åŠ é‡ã§è² è·èª¿æ•´ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'å®Œå…¨ã«é™ã‚ã—ã¦å®Œå…¨ã«ä¸Šã’ã‚‹ã€‚', bodyPart: 'èƒŒä¸­' },
            'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': { type: 'compound', repRange: '5-8', description: 'BIG3ã®ä¸€ã¤ã€‚ä¸‹åŠèº«å…¨ä½“ã‚’é›ãˆã‚‹ã€‚', strategy: 'é‡é‡ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [5, 2.5, 10], tips: 'è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‰ã«å‡ºãªã„ã‚ˆã†ã«ã€‚æ·±ãé™ã‚ã™ã€‚', bodyPart: 'è„š' },
            'ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹': { type: 'compound', repRange: '8-12', description: 'è…°ã¸ã®è² æ‹…ãŒå°‘ãªã„è„šç¨®ç›®ã€‚é«˜é‡é‡å¯èƒ½ã€‚', strategy: 'é‡é‡ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [5, 10, 2.5], tips: 'è†ã‚’å®Œå…¨ã«ãƒ­ãƒƒã‚¯ã—ãªã„ã€‚', bodyPart: 'è„š' },
            'ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«': { type: 'isolation', repRange: '10-15', description: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°é›†ä¸­ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é‡è¦–ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'ã‚†ã£ãã‚Šé™ã‚ã—ã¦ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’æ„Ÿã˜ã‚‹ã€‚', bodyPart: 'è„š' },
            'ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³': { type: 'isolation', repRange: '10-15', description: 'å¤§è…¿å››é ­ç­‹é›†ä¸­ã€‚è†ã«è² æ‹…ã‹ã‹ã‚Šã‚„ã™ã„ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'é‡ã™ãã‚‹é‡é‡ã¯è†ã‚’ç—›ã‚ã‚‹ã€‚', bodyPart: 'è„š' },
            'ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹': { type: 'compound', repRange: '6-10', description: 'è‚©å…¨ä½“ã‚’é›ãˆã‚‹åŸºæœ¬ç¨®ç›®ã€‚', strategy: 'é‡é‡ã¨å›æ•°ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆã', weightIncrements: [2.5, 1.25], tips: 'è‚©ã‚’ã™ãã‚ãªã„ã€‚ã‚³ã‚¢ã‚’ç· ã‚ã‚‹ã€‚', bodyPart: 'è‚©' },
            'ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º': { type: 'isolation', repRange: '12-20', description: 'è‚©å¹…ã‚’ä½œã‚‹ã€‚è»½ã„é‡é‡ã§é«˜å›æ•°ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [1, 1.25], tips: 'åå‹•ã‚’ä½¿ã‚ãªã„ã€‚è‚˜ã‚’è»½ãæ›²ã’ã‚‹ã€‚', bodyPart: 'è‚©' },
            'ãƒªã‚¢ãƒ‡ãƒ«ãƒˆ': { type: 'isolation', repRange: '12-20', description: 'å¾Œéƒ¨ä¸‰è§’ç­‹ã€‚å§¿å‹¢æ”¹å–„ã«ã‚‚é‡è¦ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [1, 1.25], tips: 'è»½ã„é‡é‡ã§ã—ã£ã‹ã‚ŠåŠ¹ã‹ã›ã‚‹ã€‚', bodyPart: 'è‚©' },
            'ãƒãƒ¼ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«': { type: 'isolation', repRange: '8-12', description: 'ä¸Šè…•äºŒé ­ç­‹ã€‚åå‹•ã‚’ä½¿ã‚ãªã„ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 1.25], tips: 'è‚˜ã®ä½ç½®ã‚’å›ºå®šã€‚ä½“ã‚’æºã‚‰ã•ãªã„ã€‚', bodyPart: 'è…•' },
            'ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³': { type: 'isolation', repRange: '10-15', description: 'ä¸Šè…•ä¸‰é ­ç­‹ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é‡è¦–ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'è‚˜ã‚’ä½“ã«å›ºå®šã€‚ä¼¸ã°ã—ãã‚‹ã€‚', bodyPart: 'è…•' },
            'ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«': { type: 'isolation', repRange: '10-15', description: 'ä¸Šè…•äºŒé ­ç­‹ã€‚ç‰‡è…•ãšã¤é›†ä¸­å¯èƒ½ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 1.25], tips: 'ãƒã‚¬ãƒ†ã‚£ãƒ–å‹•ä½œã‚’ã‚†ã£ãã‚Šã€‚', bodyPart: 'è…•' },
            'ã‚¯ãƒ©ãƒ³ãƒ': { type: 'isolation', repRange: '15-25', description: 'è…¹ç›´ç­‹ä¸Šéƒ¨ã€‚åŸºæœ¬çš„ãªè…¹ç­‹ç¨®ç›®ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [2.5, 5], tips: 'è…°ã‚’åºŠã«ã¤ã‘ãŸã¾ã¾ã€‚é¦–ã«åŠ›ã‚’å…¥ã‚Œãªã„ã€‚', bodyPart: 'è…¹ç­‹' },
            'ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º': { type: 'isolation', repRange: '10-20', description: 'è…¹ç›´ç­‹ä¸‹éƒ¨ã€‚è…°ã¸ã®è² æ‹…ã«æ³¨æ„ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [0, 0], tips: 'åå‹•ã‚’ä½¿ã‚ãšã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦é™ã‚ã™ã€‚', bodyPart: 'è…¹ç­‹' },
            'ãƒ—ãƒ©ãƒ³ã‚¯': { type: 'isolation', repRange: '30-90', description: 'ä½“å¹¹å…¨ä½“ã€‚ç§’æ•°ã§è¨˜éŒ²ã€‚', strategy: 'å›æ•°ï¼ˆç§’æ•°ï¼‰ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [0, 0], tips: 'ä½“ã‚’ä¸€ç›´ç·šã«ä¿ã¤ã€‚ãŠå°»ã‚’ä¸Šã’ã™ããªã„ã€‚', bodyPart: 'è…¹ç­‹' },
            'ã‚¢ãƒ–ãƒ­ãƒ¼ãƒ©ãƒ¼': { type: 'compound', repRange: '5-15', description: 'è…¹ç­‹å…¨ä½“ã«å¼·çƒˆãªè² è·ã€‚è†ã¤ãã‹ã‚‰å§‹ã‚ã‚‹ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [0, 0], tips: 'æˆ»ã‚‹æ™‚ã‚‚è…¹ç­‹ã‚’æ„è­˜ã€‚è…°ã‚’åã‚‰ã•ãªã„ã€‚', bodyPart: 'è…¹ç­‹' },
            'ãƒãƒ³ã‚®ãƒ³ã‚°ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º': { type: 'compound', repRange: '8-15', description: 'è…¹ç­‹ä¸‹éƒ¨ã¨è…¸è…°ç­‹ã€‚ä¸Šç´šè€…å‘ã‘ã€‚', strategy: 'å›æ•°ã‚’å„ªå…ˆçš„ã«å¢—ã‚„ã™', weightIncrements: [0, 0], tips: 'åå‹•ã‚’ä½¿ã‚ãšã€è†ã‚’èƒ¸ã«è¿‘ã¥ã‘ã‚‹ã€‚', bodyPart: 'è…¹ç­‹' }
        };

        let workoutHistory = JSON.parse(localStorage.getItem('workoutHistory_v6')) || [];
        let todaySets = [];
        let currentExercise = '';
        let volumeChart = null;
        let exerciseChart = null;
        let editingIndex = -1;

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tabName === 'record') {
                document.getElementById('recordTab').classList.add('active');
            } else if (tabName === 'stats') {
                document.getElementById('statsTab').classList.add('active');
                updateCharts();
            } else if (tabName === 'history') {
                document.getElementById('historyTab').classList.add('active');
                updateHistory();
            }
        }

        function getRandomComment(type) {
            const comments = asukaComments[type];
            return comments[Math.floor(Math.random() * comments.length)];
        }

        function showAsukaComment(type) {
            const commentDiv = document.getElementById('asukaComment');
            const comment = getRandomComment(type);
            commentDiv.textContent = comment;
            commentDiv.style.display = 'block';
            setTimeout(() => { commentDiv.style.display = 'none'; }, 5000);
        }

        function isSameDay(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            return d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
        }

        function showExerciseInfo() {
            const exercise = document.getElementById('exercise').value;
            const infoDiv = document.getElementById('exerciseInfo');
            const prevSetDiv = document.getElementById('previousSetInfo');
            const suggestionSection = document.getElementById('suggestionSection');
            
            if (exercise && exerciseStrategies[exercise]) {
                const info = exerciseStrategies[exercise];
                infoDiv.style.display = 'block';
                infoDiv.innerHTML = `<strong>${exercise}</strong><br><span class="badge">${info.type === 'compound' ? 'ã‚³ãƒ³ãƒ‘ã‚¦ãƒ³ãƒ‰' : 'ã‚¢ã‚¤ã‚½ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'}</span><span class="badge">æ¨å¥¨å›æ•°: ${info.repRange}</span><br>${info.description}<br>ğŸ’¡ ${info.tips}`;

                const sameExercise = workoutHistory.filter(w => w.exercise === exercise);
                if (sameExercise.length > 0) {
                    const lastWorkout = sameExercise[0];
                    const lastDate = new Date(lastWorkout.date);
                    const today = new Date();
                    
                    if (!isSameDay(lastDate, today)) {
                        showSuggestion(lastWorkout);
                    } else {
                        suggestionSection.style.display = 'none';
                    }
                    
                    prevSetDiv.style.display = 'block';
                    prevSetDiv.innerHTML = `ğŸ“‹ <strong>å‰å›ã®è¨˜éŒ²:</strong> ${lastWorkout.weight}kg Ã— ${lastWorkout.reps}å› Ã— ${lastWorkout.sets}ã‚»ãƒƒãƒˆï¼ˆ${lastDate.toLocaleDateString('ja-JP')}ï¼‰`;
                    
                    if (todaySets.length === 0 || currentExercise !== exercise) {
                        document.getElementById('weight').value = lastWorkout.weight;
                        document.getElementById('reps').value = lastWorkout.reps;
                    }
                } else {
                    prevSetDiv.style.display = 'none';
                    suggestionSection.style.display = 'none';
                }

                if (currentExercise !== exercise) {
                    currentExercise = exercise;
                    todaySets = [];
                    updateCurrentSets();
                }
            } else {
                infoDiv.style.display = 'none';
                prevSetDiv.style.display = 'none';
                suggestionSection.style.display = 'none';
            }
        }

        function updateCurrentSets() {
            const currentSetsDiv = document.getElementById('currentSets');
            const currentSetsList = document.getElementById('currentSetsList');
            
            if (todaySets.length > 0) {
                currentSetsDiv.style.display = 'block';
                currentSetsList.innerHTML = todaySets.map((set, index) => `<div class="set-item">ã‚»ãƒƒãƒˆ${index + 1}: ${set.weight}kg Ã— ${set.reps}å›</div>`).join('');
            } else {
                currentSetsDiv.style.display = 'none';
            }
        }

        function recordWorkout() {
            const exercise = document.getElementById('exercise').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const reps = parseInt(document.getElementById('reps').value);
            const sets = parseInt(document.getElementById('sets').value);

            if (!exercise || !weight || !reps || !sets) {
                showMessage('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const workout = {
                date: new Date().toISOString(),
                exercise,
                weight,
                reps,
                sets,
                volume: weight * reps * sets
            };

            for (let i = 0; i < sets; i++) {
                todaySets.push({ weight, reps });
            }

            workoutHistory.unshift(workout);
            localStorage.setItem('workoutHistory_v6', JSON.stringify(workoutHistory));

            const sameExercise = workoutHistory.filter(w => w.exercise === exercise);
            const previousWorkout = sameExercise.length > 1 ? sameExercise[1] : null;
            
            let commentType = 'normal';
            if (previousWorkout && !isSameDay(previousWorkout.date, workout.date)) {
                if (workout.volume > previousWorkout.volume) {
                    commentType = 'success';
                } else if (workout.volume < previousWorkout.volume) {
                    commentType = 'failure';
                }
            }
            
            showAsukaComment(commentType);
            updateCurrentSets();
            showMessage('âœ… ã‚»ãƒƒãƒˆã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼', 'success');

            document.getElementById('reps').value = reps;
            document.getElementById('sets').value = '1';
            document.getElementById('suggestionSection').style.display = 'none';
        }

        function addAnotherSet() {
            const exercise = document.getElementById('exercise').value;
            if (!exercise) {
                showMessage('ç¨®ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            showMessage('âœ… åŒã˜é‡é‡ãƒ»å›æ•°ã§ç¶šã‘ã¦ãã ã•ã„', 'success');
        }

        function showSuggestion(workout) {
            const strategy = exerciseStrategies[workout.exercise];
            const section = document.getElementById('suggestionSection');
            
            section.style.display = 'block';
            section.innerHTML = `<h2>ğŸ“ˆ æ¬¡å›ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ææ¡ˆ</h2><div class="suggestion-card"><h3>${workout.exercise}</h3><div class="suggestion-item"><strong>å‰å›ã®è¨˜éŒ²:</strong> ${workout.weight}kg Ã— ${workout.reps}å› Ã— ${workout.sets}ã‚»ãƒƒãƒˆ<br><strong>ç·è² è·é‡:</strong> ${workout.volume}kg</div><div class="suggestion-item"><strong>ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰æˆ¦ç•¥:</strong> ${strategy.strategy}<br><strong>æ¨å¥¨å›æ•°ç¯„å›²:</strong> ${strategy.repRange}å›</div></div><div class="suggestion-card"><h3>æ¬¡å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ææ¡ˆ</h3>${generateSuggestions(workout, strategy)}</div>`;
        }

        function generateSuggestions(workout, strategy) {
            const suggestions = [];
            strategy.weightIncrements.forEach((increment, index) => {
                if (increment > 0) {
                    const newWeight = workout.weight + increment;
                    const volumeWeight = newWeight * workout.reps * workout.sets;
                    suggestions.push({ title: `é‡é‡ã‚’+${increment}kgå¢—ã‚„ã™`, desc: `${newWeight}kg Ã— ${workout.reps}å› Ã— ${workout.sets}ã‚»ãƒƒãƒˆ`, volume: volumeWeight, increase: ((volumeWeight - workout.volume) / workout.volume * 100).toFixed(1), priority: (index === 0 && strategy.strategy.includes('é‡é‡')) ? 'â­ æ¨å¥¨' : '' });
                }
            });
            [1, 2].forEach((repIncrease, index) => {
                const newReps = workout.reps + repIncrease;
                const volumeReps = workout.weight * newReps * workout.sets;
                suggestions.push({ title: `å›æ•°ã‚’+${repIncrease}å›å¢—ã‚„ã™`, desc: `${workout.weight}kg Ã— ${newReps}å› Ã— ${workout.sets}ã‚»ãƒƒãƒˆ`, volume: volumeReps, increase: ((volumeReps - workout.volume) / workout.volume * 100).toFixed(1), priority: (index === 0 && strategy.strategy.includes('å›æ•°')) ? 'â­ æ¨å¥¨' : '' });
            });
            const newSets = workout.sets + 1;
            const volumeSets = workout.weight * workout.reps * newSets;
            suggestions.push({ title: 'ã‚»ãƒƒãƒˆæ•°ã‚’å¢—ã‚„ã™', desc: `${workout.weight}kg Ã— ${workout.reps}å› Ã— ${newSets}ã‚»ãƒƒãƒˆ`, volume: volumeSets, increase: ((volumeSets - workout.volume) / workout.volume * 100).toFixed(1), priority: '' });
            const smallWeightInc = strategy.weightIncrements[1] || strategy.weightIncrements[0];
            if (smallWeightInc > 0) {
                const combinedWeight = workout.weight + smallWeightInc;
                const combinedReps = workout.reps + 1;
                const volumeCombined = combinedWeight * combinedReps * workout.sets;
                suggestions.push({ title: 'é‡é‡ã¨å›æ•°ã‚’ä¸¡æ–¹å¢—ã‚„ã™', desc: `${combinedWeight}kg Ã— ${combinedReps}å› Ã— ${workout.sets}ã‚»ãƒƒãƒˆ`, volume: volumeCombined, increase: ((volumeCombined - workout.volume) / workout.volume * 100).toFixed(1), priority: strategy.strategy.includes('ãƒãƒ©ãƒ³ã‚¹') ? 'â­ æ¨å¥¨' : '' });
            }
            return suggestions.map((s, i) => `<div class="suggestion-item"><strong>ã‚ªãƒ—ã‚·ãƒ§ãƒ³${i + 1}: ${s.title} ${s.priority}</strong><br>${s.desc}<br>ç·è² è·é‡: ${s.volume.toFixed(1)}kg (+${s.increase}%)</div>`).join('');
        }

        function updateCharts() {
            updateVolumeChart();
            updateExerciseChart();
        }

        function updateVolumeChart() {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            const dateGroups = {};
            workoutHistory.forEach(w => {
                const date = new Date(w.date).toLocaleDateString('ja-JP');
                if (!dateGroups[date]) dateGroups[date] = 0;
                dateGroups[date] += w.volume;
            });
            const dates = Object.keys(dateGroups).reverse().slice(-10);
            const volumes = dates.map(d => dateGroups[d]);
            if (volumeChart) volumeChart.destroy();
            volumeChart = new Chart(ctx, { type: 'line', data: { labels: dates, datasets: [{ label: 'ç·è² è·é‡ (kg)', data: volumes, borderColor: '#667eea', backgroundColor: 'rgba(102, 126, 234, 0.1)', tension: 0.4, fill: true }] }, options: { responsive: true, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: true } } } });
        }

        function updateExerciseChart() {
            const ctx = document.getElementById('exerciseChart').getContext('2d');
            const exerciseMax = {};
            workoutHistory.forEach(w => {
                if (!exerciseMax[w.exercise] || w.weight > exerciseMax[w.exercise]) exerciseMax[w.exercise] = w.weight;
            });
            const exercises = Object.keys(exerciseMax);
            const maxWeights = exercises.map(e => exerciseMax[e]);
            if (exerciseChart) exerciseChart.destroy();
            exerciseChart = new Chart(ctx, { type: 'bar', data: { labels: exercises, datasets: [{ label: 'æœ€å¤§é‡é‡ (kg)', data: maxWeights, backgroundColor: 'rgba(102, 126, 234, 0.7)', borderColor: '#667eea', borderWidth: 2 }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } } });
        }

        function updateHistory() {
            const content = document.getElementById('historyContent');
            if (workoutHistory.length === 0) {
                content.innerHTML = '<p style="color: #999;">ã¾ã ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            const bodyPartGroups = {};
            workoutHistory.forEach((w, index) => {
                w.index = index;
                const bodyPart = exerciseStrategies[w.exercise]?.bodyPart || 'ãã®ä»–';
                if (!bodyPartGroups[bodyPart]) bodyPartGroups[bodyPart] = [];
                bodyPartGroups[bodyPart].push(w);
            });
            const bodyPartOrder = ['èƒ¸', 'èƒŒä¸­', 'è„š', 'è‚©', 'è…•', 'è…¹ç­‹', 'ãã®ä»–'];
            let html = '';
            bodyPartOrder.forEach(bodyPart => {
                if (bodyPartGroups[bodyPart] && bodyPartGroups[bodyPart].length > 0) {
                    html += `<div class="history-group"><h3>ğŸ’ª ${bodyPart}</h3>`;
                    bodyPartGroups[bodyPart].slice(0, 15).forEach(w => {
                        const date = new Date(w.date);
                        html += `<div class="history-item"><div class="history-item-content"><strong>${w.exercise}</strong><br>${date.toLocaleDateString('ja-JP')} ${date.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}<br>${w.weight}kg Ã— ${w.reps}å› Ã— ${w.sets}ã‚»ãƒƒãƒˆ<br><span style="color: #667eea;">ç·è² è·é‡: ${w.volume}kg</span></div><div class="history-item-actions"><button class="edit-btn" onclick="openEditModal(${w.index})">ç·¨é›†</button><button class="delete-btn" onclick="deleteWorkout(${w.index})">å‰Šé™¤</button></div></div>`;
                    });
                    html += `</div>`;
                }
            });
            content.innerHTML = html;
        }

        function openEditModal(index) {
            const workout = workoutHistory[index];
            editingIndex = index;
            document.getElementById('editExercise').value = workout.exercise;
            document.getElementById('editWeight').value = workout.weight;
            document.getElementById('editReps').value = workout.reps;
            document.getElementById('editSets').value = workout.sets;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingIndex = -1;
        }

        function saveEdit() {
            if (editingIndex === -1) return;
            const weight = parseFloat(document.getElementById('editWeight').value);
            const reps = parseInt(document.getElementById('editReps').value);
            const sets = parseInt(document.getElementById('editSets').value);
            if (!weight || !reps || !sets) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            workoutHistory[editingIndex].weight = weight;
            workoutHistory[editingIndex].reps = reps;
            workoutHistory[editingIndex].sets = sets;
            workoutHistory[editingIndex].volume = weight * reps * sets;
            localStorage.setItem('workoutHistory_v6', JSON.stringify(workoutHistory));
            closeEditModal();
            updateHistory();
            showMessage('âœ… è¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
        }

        function deleteWorkout(index) {
            if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                workoutHistory.splice(index, 1);
                localStorage.setItem('workoutHistory_v6', JSON.stringify(workoutHistory));
                updateHistory();
                showMessage('âœ… è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
            }
        }

        function exportToMarkdown() {
            if (workoutHistory.length === 0) {
                showMessage('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            let markdown = `# ğŸ‹ï¸ ç­‹ãƒˆãƒ¬è¨˜éŒ²\n\næœ€çµ‚æ›´æ–°: ${new Date().toLocaleString('ja-JP')}\n\n---\n\n`;
            const bodyPartGroups = {};
            workoutHistory.forEach(w => {
                const bodyPart = exerciseStrategies[w.exercise]?.bodyPart || 'ãã®ä»–';
                if (!bodyPartGroups[bodyPart]) bodyPartGroups[bodyPart] = {};
                if (!bodyPartGroups[bodyPart][w.exercise]) bodyPartGroups[bodyPart][w.exercise] = [];
                bodyPartGroups[bodyPart][w.exercise].push(w);
            });
            const bodyPartOrder = ['èƒ¸', 'èƒŒä¸­', 'è„š', 'è‚©', 'è…•', 'è…¹ç­‹', 'ãã®ä»–'];
            bodyPartOrder.forEach(bodyPart => {
                if (bodyPartGroups[bodyPart]) {
                    markdown += `# ${bodyPart}\n\n`;
                    for (const [exercise, workouts] of Object.entries(bodyPartGroups[bodyPart])) {
                        const strategy = exerciseStrategies[exercise];
                        markdown += `## ${exercise}\n\n`;
                        if (strategy) {
                            markdown += `**ç¨®ç›®æƒ…å ±**\n- ã‚¿ã‚¤ãƒ—: ${strategy.type === 'compound' ? 'ã‚³ãƒ³ãƒ‘ã‚¦ãƒ³ãƒ‰' : 'ã‚¢ã‚¤ã‚½ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'}\n- æ¨å¥¨å›æ•°: ${strategy.repRange}å›\n- æˆ¦ç•¥: ${strategy.strategy}\n\n`;
                        }
                        markdown += `| æ—¥æ™‚ | é‡é‡ | å›æ•° | ã‚»ãƒƒãƒˆæ•° | ç·è² è·é‡ |\n|------|------|------|----------|----------|\n`;
                        workouts.forEach(w => {
                            const date = new Date(w.date);
                            const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
                            markdown += `| ${dateStr} | ${w.weight}kg | ${w.reps}å› | ${w.sets}ã‚»ãƒƒãƒˆ | ${w.volume}kg |\n`;
                        });
                        if (workouts.length >= 1) {
                            const latest = workouts[0];
                            if (workouts.length >= 2) {
                                const previous = workouts[1];
                                const progress = ((latest.volume - previous.volume) / previous.volume * 100).toFixed(1);
                                markdown += `\n**æœ€æ–°ã®é€²æ—:** `;
                                if (progress > 0) {
                                    markdown += `ğŸ“ˆ å‰å›æ¯” +${progress}% (è‰¯å¥½ï¼)\n`;
                                } else if (progress < 0) {
                                    markdown += `ğŸ“‰ å‰å›æ¯” ${progress}%\n`;
                                } else {
                                    markdown += `â¡ï¸ å‰å›ã¨åŒã˜\n`;
                                }
                            }
                            const maxWeight = Math.max(...workouts.map(w => w.weight));
                            markdown += `**æœ€å¤§é‡é‡è¨˜éŒ²:** ${maxWeight}kg\n\n`;
                        }
                        markdown += `\n`;
                    }
                }
            });
            markdown += `---\n\n## ğŸ“Š çµ±è¨ˆæƒ…å ±\n\n- **ç·ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å›æ•°:** ${workoutHistory.length}å›\n`;
            const uniqueExercises = [...new Set(workoutHistory.map(w => w.exercise))];
            markdown += `- **è¨˜éŒ²ã—ã¦ã„ã‚‹ç¨®ç›®æ•°:** ${uniqueExercises.length}ç¨®ç›®\n`;
            const totalVolume = workoutHistory.reduce((sum, w) => sum + w.volume, 0);
            markdown += `- **ç´¯è¨ˆç·è² è·é‡:** ${totalVolume.toLocaleString()}kg\n`;
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workout-log-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
            URL.revokeObjectURL(url);
            showMessage('âœ… ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼', 'success');
        }

        function clearAllData() {
            if (confirm('æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                workoutHistory = [];
                todaySets = [];
                currentExercise = '';
                localStorage.removeItem('workoutHistory_v6');
                updateCharts();
                updateHistory();
                document.getElementById('suggestionSection').style.display = 'none';
                document.getElementById('currentSets').style.display = 'none';
                showMessage('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
            }
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.style.display = 'block';
            setTimeout(() => { msg.style.display = 'none'; }, 3000);
        }

        window.onload = function() {
            updateCharts();
            updateHistory();
        };

        window.onclick = function(event) {
            if (event.target == document.getElementById('editModal')) {
                closeEditModal();
            }
        };
    </script>
</body>
</html>
